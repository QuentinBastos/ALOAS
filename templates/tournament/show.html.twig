{% extends 'base.html.twig' %}

{% block title %}Tournoi - {{ tournament.name }}{% endblock %}

{% block body %}
    {% include 'partial/header.html.twig' %}
    {% include 'partial/rightAside.html.twig' %}
    <div class="shadow">
        {% include 'partial/doubleNav.html.twig' %}
    </div>
    <div class="flex w-full h-screen container mx-auto flex flex-col md:flex-row gap-4 md:gap-8 pt-6 text-xl font-medium main-content">
        <div class="w-full md:w-[80%] flex flex-col items-center px-4">
            <h1 class="text-2xl font-bold text-[--bg-green-light] text-center">Tournoi : {{ tournament.name }}</h1>
            <ul class="flex flex-col md:flex-row w-full justify-between items-center mt-2 text-center md:text-left">
                <li class="flex text-gray-700">
                    {% if tournament.sport.name == 'football' %}
                        ‚öΩ
                    {% elseif tournament.sport.name == 'tennis' %}
                        üéæ
                    {% elseif tournament.sport.name == 'basketball' %}
                        üèÄ
                    {% endif %}
                    Sport : {{ tournament.sport.name }}
                </li>
                <li class="flex text-gray-700">Lieu : {{ tournament.location }}</li>
                <li class="flex text-gray-700">Date : {{ tournament.date|date('d/m/Y') }}</li>
            </ul>

            <h2 class="text-xl font-bold mt-6">Matchs</h2>

            {% if matches is empty %}
                <p class="text-gray-500">Aucun match g√©n√©r√© pour l'instant.</p>
            {% else %}
                <form class="w-full" action="{{ path('app_tournament_update_scores', {'id': tournament.id}) }}" method="POST">
                    <div class="tournament-tree w-full overflow-x-auto">
                        {% set maxPhases = (matches|map(m => m.phase))|reduce((carry, item) => item > carry ? item : carry, 1) %}

                        {% for phase in maxPhases..1 %}
                            <div class="phase phase-{{ phase }}">
                                <h2 class="text-center text-xl font-bold my-4">Phase {{ phase }}</h2>
                                <div class="matches flex flex-wrap justify-center gap-x-4 gap-y-4 w-full overflow-x-auto">
                                    {% for match in matches %}
                                        {% if match.phase == phase %}
                                            <div class="flex items-center justify-around border-2 rounded shadow py-2 px-2 gap-2 bg-white min-w-[280px]">
                                                <img src="{{ asset('build/images/team/' ~ match.home.name|lower ~ '.svg') }}"
                                                     alt="{{ match.home.name }}" class="h-12 w-12 object-contain">

                                                <input type="number" name="home_score_{{ match.id }}" value="{{ match.homeScore ?? '' }}"
                                                       class="w-12 text-center border border-gray-300 rounded">

                                                <p class="font-bold text-lg">/</p>

                                                <input type="number" name="visitor_score_{{ match.id }}" value="{{ match.visitorScore ?? '' }}"
                                                       class="w-12 text-center border border-gray-300 rounded">

                                                <img src="{{ asset('build/images/team/' ~ match.visitor.name|lower ~ '.svg') }}"
                                                     alt="{{ match.visitor.name }}" class="h-12 w-12 object-contain">
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="text-center my-6">
                        <button type="submit" class="px-6 py-2 bg-[--bg-green-dark] text-white rounded shadow w-full md:w-auto">Valider les scores</button>
                    </div>
                </form>
            {% endif %}
        </div>

        <div class="flex flex-col w-full md:w-[20%] gap-8 px-4">
            <div class="flex flex-col items-center justify-between rounded shadow-md w-full">
                <h2 class="flex items-center justify-center text-sm font-bold bg-[--bg-green-dark] text-white w-full px-2 py-2 rounded-t">√âquipes participantes</h2>
                <ul class="w-full mt-2 px-2">
                    {% for key, team in teams %}
                        <li class="flex items-center w-full justify-between text-sm">
                            <p>{{ key + 1 }}: Equipe</p>
                            <img class="w-[24px]" src="{{ asset('build/images/team/' ~ team.name ~ '.svg') }}" alt={{ team.name }} >
                        </li>
                    {% else %}
                        <li class="text-gray-500">Aucune √©quipe inscrite.</li>
                    {% endfor %}
                </ul>

                <a href="{{ path('app_team_add', {'tournamentId': tournament.id}) }}" class="mt-4 text-white bg-[--bg-green-light] px-2 mb-2 py-2 rounded text-sm text-center w-full">
                    + Modifier l'√©quipe
                </a>
            </div>
            <div class="flex flex-col items-center justify-between rounded shadow-md bg-white w-full">
                <h2 class="flex items-center justify-center text-sm font-bold bg-[--bg-green-dark] text-white w-full px-2 py-2 rounded-t">Chronos</h2>

                <p id="timerDisplay" class="text-2xl font-bold my-2">00:00</p>

                <div class="flex space-x-2 p-2">
                    <button id="startStopBtn" class="px-4 py-2 bg-[--bg-green-light] text-white rounded text-sm w-full md:w-auto">D√©marrer</button>
                    <button id="resetBtn" class="p-2 bg-neutral-300 text-white rounded text-sm w-full md:w-auto">Red√©marrer</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    <style>
        .tournament-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: auto;
        }

        .phase {
            margin: 20px 0;
            text-align: center;
        }

        .matches {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
    </style>
{% endblock %}
